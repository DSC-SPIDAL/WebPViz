<html>
<head>
    <title>Smacof Dtrans 1.0 CG 100 MinDefComp 40 ZeroPairCount 60</title>
    <style>
        body {
            margin: 0;
            background-color: #ffffff;
        }

        canvas {
            width: 100%;
            height: 100%
        }
    </style>
</head>
<body>
<script src="../../js/papaparse.min.js"></script>
<script src="../../js/three.min.js"></script>
<script src="../../js/Detector.js"></script>
<script src="../../js/stats.min.js"></script>
<script src="../../js/randomColor.js"></script>
<script src="../../js/OrbitControls.js"></script>
<script>
    if (!Detector.webgl) Detector.addGetWebGLMessage();
    var container, stats;
    var camera, scene, renderer, sprite, colors = [], particles, material, controls, light;
    var mesh;
    var particleSystem;
    var colorMap = {};

    var mouseX = 10, mouseY = 10;
    var windowHalfX = window.innerWidth / 2;
    var windowHalfY = window.innerHeight / 2;

    init();
    animate();

    function init() {
        container = document.body;
        camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.05, 1000);
        camera.position.set(10,10,10);
        scene = new THREE.Scene();
        var heus = [0.05, 0.3, 0.15, 0.2, 0.25, 0.3, 0.35, 0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8, 0.85, 0.9, 0.95];
        var matlab50 = new Array(50);
        Papa.parse("../../colors/Matlab50.txt", {
            download: true,
            complete: function (results) {
                for (var i in results.data) {
                    matlab50[i] = new Array(4);
                    var row = results.data[i];
                    matlab50[i][0] = row[0];
                    matlab50[i][1] = row[1];
                    matlab50[i][2] = row[2];
                    matlab50[i][3] = row[3];
                }
            }
        });
        Papa.parse("../../data/chinahealth/smacof.dtrans1.0.cg100_mindefcomp.40_zeropaircount.60_c8.txt", {
            download: true,
            complete: function (results) {

                var geometry = new THREE.Geometry();
                var colors = [];

                for (var i in results.data) {
                    var row = results.data[i];

                    var hsl;

                    hsl = [heus[row[4]], 1, 0.8];

                    var vertex = new THREE.Vector3();
                    vertex.x = row[1] * 10;
                    vertex.y = row[2] * 10;
                    vertex.z = row[3] * 10;

                    geometry.vertices.push(vertex);

                    var idx = row[4] % 50;
                    var r = matlab50[idx][0];
                    var g = matlab50[idx][1];
                    var b = matlab50[idx][2];
                    colors[i] = new THREE.Color("rgb(" + r + "," + g + "," + b + ")");
                }

                geometry.colors = colors;
                material = new THREE.PointCloudMaterial({ size: 0.05, map: sprite, vertexColors: THREE.VertexColors, transparent: true });
                material.color.setHSL(1.0, 1, 1);
                particles = new THREE.PointCloud(geometry, material);
                particles.sortParticles = true;
                scene.add(particles);

                renderer = new THREE.WebGLRenderer({clearAlpha: 1, antialias: true});
                //renderer.setClearColor( 0x, 1);
                //renderer.setClearColor( scene.fog.color, 1 );
                renderer.setSize(window.innerWidth, window.innerHeight);
                // Add OrbitControls so that we can pan around with the mouse.
                controls = new THREE.OrbitControls(camera, renderer.domElement);
                container.appendChild(renderer.domElement);

                stats = new Stats();
                stats.domElement.style.position = 'absolute';
                stats.domElement.style.top = '0px';
                container.appendChild(stats.domElement);
                window.addEventListener('resize', onWindowResize, false);
            }
        });
    }
    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
        controls.handleResize();
        render();
    }
    //
    function animate() {
        requestAnimationFrame(animate);
        controls.update();
        render();
    }


    function render() {
        renderer.render(scene, camera);
        stats.update();
    }
</script>
</body>
</html>
