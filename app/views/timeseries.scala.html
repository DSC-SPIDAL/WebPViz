@(user: User, timeSeriesId: Integer, timeSeriesName: String)

@main(timeSeriesName, user) {
    <link rel="stylesheet" href="@routes.Assets.at("stylesheets/ion-rangeslider/ion.rangeSlider.css")">
    <link rel="stylesheet" href="@routes.Assets.at("stylesheets/ion-rangeslider/ion.rangeSlider.skinNice.css")">
    <link rel="stylesheet" href="@routes.Assets.at("stylesheets/colorpicker/bootstrap-colorpicker.min.css")">
    <link rel="stylesheet" href="@routes.Assets.at("stylesheets/plot.css")">
    <div class="row plot">
            <!--div class="col-sm-9 col-sm-offset-3 col-md-10 col-sm-offset-2 plotviz"-->
        <div class="col-sm-12 col-md-12 plotviz">
            <div class="viz-clusters col-sm-12 col-md-12 hidden-xs hidden-sm" id="plot-clusters"></div>
            <div class="plot-controls hidden-xs" id="plot-controls"></div>
            <div id="progress">
                <span id="message">Loading ...</span>
                <center>
                    @*<div id="progressbar" class="shadow"><div id="bar" class="shadow"></div></div>*@
                    <img src="/assets/images/ajax-loader.gif" id="loading-indicator"/>
                </center>

            </div>
            <canvas id="canvas3d" class="effect6">
            </canvas>
            <p class="viz-title" id="plot-title"></p>
            <div class="input-group input-group-shaded effect6">
                <div class="input-group-btn">
                    <button id="plot-reset" type="button" class="btn btn-default btn-circle margin-left-five" aria-label="Reset"><span id="plot-reset-span" class="glyphicon glyphicon-screenshot"></span></button>
                </div>
                <div class="input-group-btn">
                    <button id="slider-step-backward" type="button" class="btn btn-default btn-circle margin-left-five" aria-label="Step-Backward"><span id="step-backward-span" class="glyphicon glyphicon-step-backward"></span></button>
                </div>
                <div class="input-group-btn">
                    <button id="slider-play" type="button" class="btn btn-default btn-circle margin-left-five" aria-label="Play"><span id="play-span" class="glyphicon glyphicon-play"></span></button>
                </div>
                <div class="input-group-btn">
                    <button id="slider-step-forward" type="button" class="btn btn-default btn-circle margin-left-five" aria-label="Step-Forward"><span id="step-forward-span" class="glyphicon glyphicon-step-forward"></span></button>
                </div>
                <input type="text" id="plot-slider" class="form-control">
                <div class="input-group-btn">
                    <button type="button"  id="settings-toggle" class="btn btn-default btn-circle margin-right-five">
                        <span class="glyphicon glyphicon-th-list"></span>
                    </button>
                    <button id="plot-save" type="button" class="btn btn-default btn-circle margin-left-five plot-save" aria-label="Save"><span id="plot-reset-span" class="glyphicon glyphicon-save"></span></button>
                </div>
            </div>
        </div>
    </div>

    <div id="settingDiv" class="settingdiv settinghidden">
        <div class="settingdiv-header">
            <h4>Visualization Settings</h4>
        </div>
        <div id="cluster_table_div" class="cluster_table_div">

        </div>
        <div class="settingdiv-footer">
            <input type="checkbox" name="color_picker_enable" value="color_picker_enable" id="color_picker_enable" class="color_enable margin-left-five pull-left"><span class="pull-left">Enable Coloring</span>
            <button type="button" id="settings-div-close" class="btn btn-default margin-right-five">Close</button>
        </div>
    </div>

    <script type="text/javascript" src="@routes.Assets.at("javascripts/custom.js")"></script>
    <script type="text/javascript" src="@routes.Assets.at("javascripts/plot.js")"></script>
    <script type="text/javascript" src="@routes.Assets.at("javascripts/three.min.js")"></script>
    <script type="text/javascript" src="@routes.Assets.at("javascripts/dat.gui.min.js")"></script>
    <script type="text/javascript" src="@routes.Assets.at("javascripts/colorpicker/docs.js")"></script>
    <script type="text/javascript" src="@routes.Assets.at("javascripts/colorpicker/bootstrap-colorpicker.js")"></script>
    <script type="text/javascript" src="@routes.Assets.at("javascripts/three.min.js")"></script>
    <script type="text/javascript" src="@routes.Assets.at("javascripts/threeutils/Detector.js")"></script>
    <script type="text/javascript" src="@routes.Assets.at("javascripts/threeutils/TrackballControls.js")"></script>
    <script type="text/javascript" src="@routes.Assets.at("javascripts/threeutils/OrbitControls.js")"></script>
    <script type="text/javascript" src="@routes.Assets.at("javascripts/threeutils/stats.min.js")"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/randomcolor/0.1.1/randomColor.min.js"></script>
    <script type="text/javascript" src="@routes.Assets.at("javascripts/ion-rangeslider/ion.rangeSlider.min.js")"></script>
    <script src="@routes.Assets.at("javascripts/isotope.pkgd.js")"></script>
    <script src="//code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
    <script>
            $(function() {
                 $('.color_enable').click(function() {
                    var $this = $(this);
                    // $this will contain a reference to the checkbox
                    if ($this.is(':checked')) {
                        colorEnable(true);
                    } else {
                        // the checkbox was unchecked
                        colorEnable(false);
                    }
                });
                $('.plot-save').click(function() {
                    savePlot();
                });
                $('#slider-play').click(function () {
                    var span = $("#play-span");

                    if (span.hasClass("glyphicon-play")) {
                        animateTimeSeriesPlay();
                        span.removeClass("glyphicon-play").addClass("glyphicon-pause");
                    } else if (span.hasClass("glyphicon-repeat")) {
                        resetSlider();
                        span.removeClass("glyphicon-repeat").addClass("glyphicon-play");
                    } else {
                        animateTimeSeriesPause();
                        span.removeClass("glyphicon-pause").addClass("glyphicon-play");
                    }
                });

                $('#slider-step-backward').click(function () {
                    var currentval = plotRangeSlider.result.from - 1;
                    if((currentval > 0) && !isPlaying ){
                        updatePlot(currentval);
                        plotRangeSlider.update({from: currentval});
                    }
                });

                $('#slider-step-forward').click(function () {
                    var currentval = plotRangeSlider.result.from + 1;
                    if((currentval < timeSeriesLength) && !isPlaying ){
                        updatePlot(currentval);
                        plotRangeSlider.update({from: currentval + 1});
                    }
                });

                $('#plot-reset').click(function () {
                    resetView()
                });

                $('#settings-toggle').click(function () {
                    var settingsdiv = $("#settingDiv");

                    if(settingsdiv.hasClass("settinghidden")){
                        settingsdiv.removeClass("settinghidden")
                    }else{
                        settingsdiv.addClass("settinghidden")
                    }
                });

                $('#settings-div-close').click(function () {
                   var settingsdiv = $("#settingDiv");

                    if(settingsdiv.hasClass("settinghidden")){
                        settingsdiv.removeClass("settinghidden")
                    }else{
                        settingsdiv.addClass("settinghidden")
                    }
                });


                $('.modal-dialog').draggable({
                    handle: ".modal-header"
                });

                $('.modal-dialog').resizable();

                $('.modal-backdrop').removeClass("modal-backdrop");

            });
    </script>
    <script type="text/javascript">
          if ( !Detector.webgl ){
                //TODO needs to go to seperate page when WebGL is not supported
                Detector.addGetWebGLMessage({"id":"canvas3d"});
          }else{
                $.getJSON("@routes.Application.getArtifact(timeSeriesId)", function (data) {
                    var resultSetUrl = "@routes.Application.getArtifact(timeSeriesId)";
                    visualizeTimeSeries(resultSetUrl, data, @timeSeriesId);
                });
            }
    </script>
}